<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>お題シャッフルアプリ</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; }
        .container { width: 80%; margin: auto; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid black; padding: 10px; text-align: center; }
    </style>
</head>
<body>
    <div class="container">
        <h4>バージョン 1.1</h4>
        <h2>お題シャッフルアプリ</h2>
        
        <label for="playerCount">人数を選択：</label>
        <select id="playerCount">
            <option value="2">2人</option>
            <option value="3">3人</option>
            <option value="4" selected>4人</option>
            <option value="5">5人</option>
            <option value="6">6人</option>
        </select>
        <button id="generateInputs">入力欄を生成</button>

        <div class="player-container" id="playerContainer"></div>

        <button id="submit" style="display:none;">送信</button>

        <div id="resultContainer" style="display: none;">
            <h3>シャッフル結果</h3>
            <table>
                <thead>
                    <tr>
                        <th>プレイヤー</th>
                        <th>お題1</th>
                        <th>お題2</th>
                    </tr>
                </thead>
                <tbody id="resultTableBody"></tbody>
            </table>
        </div>
    </div>

    <script>
        document.getElementById("generateInputs").addEventListener("click", function() {
            let count = parseInt(document.getElementById("playerCount").value);
            let container = document.getElementById("playerContainer");
            container.innerHTML = "";
            
            for (let i = 0; i < count; i++) {
                let div = document.createElement("div");
                div.innerHTML = `
                    <input type="text" placeholder="プレイヤー名" class="playerName">
                    <input type="text" placeholder="お題1" class="word1">
                    <input type="text" placeholder="お題2" class="word2">
                `;
                container.appendChild(div);
            }
            document.getElementById("submit").style.display = "block";
        });

        document.getElementById("submit").addEventListener("click", function() {
            let players = [];
            document.querySelectorAll(".playerName").forEach((el, index) => {
                players.push({
                    name: el.value,
                    word1: document.querySelectorAll(".word1")[index].value,
                    word2: document.querySelectorAll(".word2")[index].value
                });
            });
            
            let shuffledWords = players.flatMap(p => [p.word1, p.word2]);
            let validAssignments = false;
            let results = [];
            
            while (!validAssignments) {
                let tempShuffled = [...shuffledWords].sort(() => Math.random() - 0.5);
                validAssignments = true;
                results = players.map(player => {
                    let availableWords = tempShuffled.filter(w => w !== player.word1 && w !== player.word2);
                    if (availableWords.length < 2) {
                        validAssignments = false;
                        return null;
                    }
                    let word1 = availableWords.splice(Math.floor(Math.random() * availableWords.length), 1)[0];
                    let word2 = availableWords.splice(Math.floor(Math.random() * availableWords.length), 1)[0];
                    return { name: player.name, word1, word2 };
                });
            }
            displayResults(results);
        });

        function displayResults(results) {
            let resultContainer = document.getElementById("resultContainer");
            let resultTableBody = document.getElementById("resultTableBody");
            resultTableBody.innerHTML = "";
            
            results.forEach(player => {
                let row = document.createElement("tr");
                row.innerHTML = `<td>${player.name}</td><td>${player.word1}</td><td>${player.word2}</td>`;
                resultTableBody.appendChild(row);
            });
            
            resultContainer.style.display = "block";
        }
    </script>
</body>
</html>
